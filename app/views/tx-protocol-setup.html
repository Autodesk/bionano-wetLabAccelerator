<div class="protocol-setup-header"
     ng-click="isCollapsed = !isCollapsed"
     ng-class="{'open':isCollapsed}">
  setup
</div>
<table class="protocol-setup-main"
       ng-show="isCollapsed"
       ng-class="{'open':isCollapsed}">
  <thead>
  <tr>
    <th colspan="4"><button class="btn btn-default" ng-click="setupCtrl.addParam()">Add Parameter</button></th>
  </tr>
  </thead>
  <tr ng-repeat="param in setupCtrl.parameters">
    <!--hack - this should be a div, pending restyling of setupCtrl -->
    <td class="verification" ng-if="param.verification">
      <div class="verification-alert">
        <span class="glyphicon glyphicon-alert"></span>
      </div>
      <div class="verification-flag">
        <span ng-bind="param.verification.message"></span>
      </div>
    </td>
    <td><input type="text"
               ng-model="param.name"
               tx-change-broadcaster="editor:parameterNameChange"></td>
    <td><select ng-model="param.type"
                ng-change="setupCtrl.handleChangeParamType(param)"
                ng-options="o as o for (o, meta) in setupCtrl.paramTypes"></select></td>
    <td ng-switch="param.type">
      <div ng-switch-when="container">
        <table>
          <tr>
            <td>
              <input type="color"
                     ng-required="true"
                     ng-model="param.value.color">
            </td>
            <td>
              <input type="checkbox"
                     ng-model="param.value.isNew"> new?
            </td>
            <td ng-if="param.value.isNew">
              <select ng-model="param.value.type"
                      ng-required="param.value.isNew"
                      ng-change="notifyContainerChange(param)"
                      ng-options="t as t for (t, opts) in setupCtrl.containerOptions"></select>
            </td>
            <td ng-if="!param.value.isNew">
              <select ng-model="dummyRemote"
                      ng-required="!param.value.isNew"
                      ng-change="setupCtrl.handleSelectRemoteContainer(param, dummyRemote)"
                      ng-options="c as (c.name || c.id) for c in setupCtrl.remoteContainers"></select>
            </td>
            <td>
              <select ng-model="param.value.storage"
                      ng-options="o as o for o in setupCtrl.storageOptions"></select>
            </td>
          </tr>
        </table>
      </div>
      <div ng-switch-default>
        <tx-protocol-field field="param"
                           ng-model="param.value"
                           hide-title="true"
                           prevent-variable="true"></tx-protocol-field>
      </div>
    </td>
    <td>
      <a class="close" ng-click="setupCtrl.deleteParam(param)">&times;</a>
    </td>
  </tr>
</table>
